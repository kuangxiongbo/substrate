# 国际化强制规范实施计划

## 项目概述
实施 Spec-Kit 国际化强制规范，确保所有用户界面文本必须通过国际化(i18n)系统管理，禁止硬编码文本，保证多语言支持和本地化一致性。

## 实施目标
1. **建立国际化验证机制**: 开发、构建、运行时三层验证
2. **迁移现有硬编码文本**: 将所有硬编码文本迁移到翻译键
3. **建立工具链**: 开发验证工具和自动修复工具
4. **培训团队**: 确保团队理解和遵循国际化规范

## 实施阶段

### 第一阶段：基础设施建立 (1-2天)

#### 1.1 创建验证工具
- [ ] **任务**: 开发 ESLint 自定义规则
  - 创建 `eslint-plugin-i18n` 插件
  - 实现 `no-hardcoded-text` 规则
  - 实现 `require-translation-key` 规则
  - 实现 `validate-translation-structure` 规则
  - 添加自动修复功能
  - 优先级: 高
  - 预估时间: 4小时

- [ ] **任务**: 创建构建时验证插件
  - 开发 `vite-plugin-i18n-validator` 插件
  - 实现翻译键扫描功能
  - 实现语言包同步检查
  - 添加构建时错误报告
  - 优先级: 高
  - 预估时间: 6小时

- [ ] **任务**: 实现运行时验证器
  - 创建 `I18nValidator` 类
  - 实现硬编码文本检测方法
  - 实现翻译键验证方法
  - 添加违规报告机制
  - 优先级: 中
  - 预估时间: 4小时

- [ ] **任务**: 建立翻译键追踪系统
  - 实现翻译键使用追踪器
  - 添加翻译覆盖率统计
  - 实现缺失翻译键检测
  - 添加性能监控
  - 优先级: 中
  - 预估时间: 3小时

#### 1.2 配置开发环境
- [ ] **任务**: 更新 ESLint 配置
  - 安装自定义 ESLint 插件
  - 配置规则到 `.eslintrc.js`
  - 设置规则严重级别
  - 配置自动修复选项
  - 优先级: 高
  - 预估时间: 1小时

- [ ] **任务**: 配置 Vite 构建插件
  - 安装 Vite 插件
  - 配置 `vite.config.js`
  - 设置验证选项
  - 配置错误处理
  - 优先级: 高
  - 预估时间: 1小时

- [ ] **任务**: 设置 Git hooks 验证
  - 创建 pre-commit hook
  - 添加国际化验证检查
  - 配置提交前验证
  - 添加错误提示
  - 优先级: 中
  - 预估时间: 2小时

- [ ] **任务**: 配置 IDE 插件支持
  - 配置 VS Code 扩展
  - 设置实时验证
  - 添加错误高亮
  - 配置自动修复
  - 优先级: 低
  - 预估时间: 1小时

#### 1.3 建立国际化验证框架
- [ ] **任务**: 创建国际化验证器类
  - 实现 `I18nValidator` 基础类
  - 添加硬编码文本检测方法
  - 实现翻译键验证方法
  - 建立违规报告机制
  - 优先级: 高
  - 预估时间: 3小时

- [ ] **任务**: 实现翻译键扫描器
  - 创建 `TranslationKeyScanner` 类
  - 实现 AST 解析功能
  - 添加翻译键提取方法
  - 实现使用统计功能
  - 优先级: 高
  - 预估时间: 4小时

- [ ] **任务**: 建立语言包验证器
  - 创建 `LanguagePackValidator` 类
  - 实现结构一致性检查
  - 添加缺失键检测
  - 实现同步验证功能
  - 优先级: 高
  - 预估时间: 3小时

### 第二阶段：现有代码迁移 (2-3天)

#### 2.1 页面组件国际化迁移
- [ ] **任务**: 扫描现有页面组件中的硬编码文本
  - 扫描所有 `.tsx` 文件
  - 识别硬编码文本位置
  - 生成迁移报告
  - 创建翻译键映射
  - 优先级: 高
  - 预估时间: 2小时

- [ ] **任务**: 迁移页面组件硬编码文本
  - 迁移 `LoginPage.tsx` 硬编码文本
  - 迁移 `DashboardPage.tsx` 硬编码文本
  - 迁移 `UserManagementPage.tsx` 硬编码文本
  - 迁移 `OverviewPage.tsx` 硬编码文本
  - 优先级: 高
  - 预估时间: 4小时

- [ ] **任务**: 迁移设置页面硬编码文本
  - 迁移 `BasicConfigPage.tsx` 硬编码文本
  - 迁移 `EmailConfigPage.tsx` 硬编码文本
  - 迁移 `SecurityConfigPage.tsx` 硬编码文本
  - 迁移 `AdminManagementPage.tsx` 硬编码文本
  - 优先级: 高
  - 预估时间: 4小时

- [ ] **任务**: 迁移其他页面硬编码文本
  - 迁移 `FileManagerPage.tsx` 硬编码文本
  - 迁移 `DataBackupPage.tsx` 硬编码文本
  - 迁移 `SystemSettings.tsx` 硬编码文本
  - 迁移 `OperationLogsPage.tsx` 硬编码文本
  - 优先级: 中
  - 预估时间: 3小时

#### 2.2 组件国际化迁移
- [ ] **任务**: 迁移布局组件硬编码文本
  - 迁移 `SidebarLayout.tsx` 硬编码文本
  - 迁移 `TopMenuLayout.tsx` 硬编码文本
  - 迁移 `ContentPageLayout.tsx` 硬编码文本
  - 迁移 `LayoutWrapper.tsx` 硬编码文本
  - 优先级: 高
  - 预估时间: 3小时

- [ ] **任务**: 迁移通用组件硬编码文本
  - 迁移 `LanguageSwitcher.tsx` 硬编码文本
  - 迁移 `LayoutSwitcher.tsx` 硬编码文本
  - 迁移 `ImageCropper.tsx` 硬编码文本
  - 迁移其他通用组件
  - 优先级: 中
  - 预估时间: 2小时

#### 2.3 语言包完善
- [ ] **任务**: 完善中文语言包
  - 添加缺失的翻译键
  - 优化现有翻译内容
  - 统一翻译风格
  - 验证翻译质量
  - 优先级: 高
  - 预估时间: 2小时

- [ ] **任务**: 完善英文语言包
  - 添加缺失的翻译键
  - 优化现有翻译内容
  - 统一翻译风格
  - 验证翻译质量
  - 优先级: 高
  - 预估时间: 2小时

- [ ] **任务**: 建立翻译键命名规范
  - 制定命名规范文档
  - 重构现有翻译键
  - 建立层级结构
  - 优化键名语义
  - 优先级: 中
  - 预估时间: 2小时

### 第三阶段：工具链完善 (1-2天)

#### 3.1 开发工具
- [ ] **任务**: 国际化扫描器
  - 创建命令行扫描工具
  - 实现批量文件扫描
  - 添加报告生成功能
  - 实现自动修复建议
  - 优先级: 中
  - 预估时间: 3小时

- [ ] **任务**: 翻译键验证器
  - 创建翻译键验证工具
  - 实现完整性检查
  - 添加同步验证功能
  - 实现质量评估
  - 优先级: 中
  - 预估时间: 2小时

- [ ] **任务**: 自动修复工具
  - 创建自动修复工具
  - 实现硬编码文本替换
  - 添加翻译键生成功能
  - 实现批量修复
  - 优先级: 低
  - 预估时间: 4小时

#### 3.2 构建工具
- [ ] **任务**: Vite 插件优化
  - 优化构建时验证性能
  - 添加缓存机制
  - 实现增量检查
  - 优化错误报告
  - 优先级: 中
  - 预估时间: 2小时

- [ ] **任务**: 构建时验证
  - 完善构建时检查逻辑
  - 添加翻译键完整性验证
  - 实现语言包同步检查
  - 优化构建性能
  - 优先级: 高
  - 预估时间: 2小时

#### 3.3 监控工具
- [ ] **任务**: 运行时监控
  - 创建运行时监控器
  - 实现缺失翻译键检测
  - 添加性能监控
  - 实现违规统计
  - 优先级: 低
  - 预估时间: 3小时

- [ ] **任务**: 国际化合规仪表板
  - 创建合规仪表板
  - 显示翻译覆盖率
  - 展示违规统计
  - 提供修复建议
  - 优先级: 低
  - 预估时间: 4小时

### 第四阶段：测试和验证 (1天)

#### 4.1 功能测试
- [ ] **任务**: 国际化功能测试
  - 测试语言切换功能
  - 测试翻译键加载
  - 测试参数化翻译
  - 测试复数形式处理
  - 优先级: 高
  - 预估时间: 2小时

- [ ] **任务**: 验证工具测试
  - 测试 ESLint 规则
  - 测试 Vite 插件
  - 测试运行时验证器
  - 测试自动修复工具
  - 优先级: 高
  - 预估时间: 2小时

#### 4.2 合规性测试
- [ ] **任务**: 硬编码文本检测测试
  - 测试各种硬编码文本检测
  - 验证误报和漏报
  - 测试边界情况
  - 验证检测准确性
  - 优先级: 高
  - 预估时间: 1小时

- [ ] **任务**: 翻译键验证测试
  - 测试翻译键存在性检查
  - 测试语言包同步验证
  - 测试结构一致性检查
  - 验证验证准确性
  - 优先级: 高
  - 预估时间: 1小时

#### 4.3 性能测试
- [ ] **任务**: 构建性能测试
  - 测试构建时验证性能
  - 测试增量检查性能
  - 测试缓存机制效果
  - 优化构建时间
  - 优先级: 中
  - 预估时间: 1小时

- [ ] **任务**: 运行时性能测试
  - 测试翻译键查找性能
  - 测试语言包加载性能
  - 测试内存使用情况
  - 优化运行时性能
  - 优先级: 中
  - 预估时间: 1小时

### 第五阶段：文档和培训 (1天)

#### 5.1 文档完善
- [ ] **任务**: 更新开发文档
  - 更新国际化开发指南
  - 创建验证工具使用文档
  - 编写最佳实践文档
  - 建立常见问题解答
  - 优先级: 高
  - 预估时间: 2小时

- [ ] **任务**: 创建迁移指南
  - 编写硬编码文本迁移指南
  - 创建翻译键命名指南
  - 编写语言包维护指南
  - 建立故障排除指南
  - 优先级: 中
  - 预估时间: 2小时

#### 5.2 团队培训
- [ ] **任务**: 规范介绍培训
  - 介绍国际化强制规范
  - 讲解验证工具使用
  - 演示最佳实践
  - 解答常见问题
  - 优先级: 高
  - 预估时间: 1小时

- [ ] **任务**: 工具使用培训
  - 培训 ESLint 规则使用
  - 培训 Vite 插件配置
  - 培训验证工具使用
  - 培训故障排除方法
  - 优先级: 中
  - 预估时间: 1小时

## 技术实施细节

### 1. ESLint 自定义规则
```javascript
// eslint-plugin-i18n
module.exports = {
  rules: {
    'no-hardcoded-text': {
      meta: {
        docs: {
          description: '禁止硬编码用户可见文本',
          category: 'Possible Errors',
          recommended: true
        }
      },
      create(context) {
        return {
          JSXText(node) {
            if (node.value.trim() && !isTechnicalText(node.value)) {
              context.report({
                node,
                message: '禁止硬编码文本，请使用 t() 函数'
              });
            }
          },
          Literal(node) {
            if (typeof node.value === 'string' && 
                isUserVisibleText(node.value) && 
                !isInTranslationCall(node)) {
              context.report({
                node,
                message: '禁止硬编码文本，请使用 t() 函数'
              });
            }
          }
        };
      }
    }
  }
};
```

### 2. Vite 构建插件
```javascript
// vite-plugin-i18n-validator
export function i18nValidator(options = {}) {
  return {
    name: 'i18n-validator',
    buildStart() {
      // 扫描翻译键使用
      // 检查语言包同步
      // 验证翻译键完整性
    },
    transform(code, id) {
      // 检测硬编码文本
      // 验证翻译键存在
      // 生成验证报告
    }
  };
}
```

### 3. 运行时验证器
```typescript
// I18nValidator
export class I18nValidator {
  private translationKeys: Set<string> = new Set();
  private languagePacks: Map<string, any> = new Map();
  
  validateHardcodedText(code: string): ValidationResult {
    const violations: Violation[] = [];
    // 检测硬编码文本
    return { valid: violations.length === 0, violations };
  }
  
  validateTranslationKeys(): ValidationResult {
    const violations: Violation[] = [];
    // 验证翻译键完整性
    return { valid: violations.length === 0, violations };
  }
  
  validateLanguagePackSync(): ValidationResult {
    const violations: Violation[] = [];
    // 验证语言包同步
    return { valid: violations.length === 0, violations };
  }
}
```

## 验收标准

### 1. 功能完整性
- 所有硬编码文本已迁移到翻译键
- 所有语言包结构一致
- 翻译键命名符合规范
- 参数化翻译正确工作

### 2. 工具集成
- ESLint 规则正常工作
- Vite 插件构建时验证有效
- 运行时验证器功能正常
- 自动修复工具可用

### 3. 性能要求
- 构建时验证不影响构建性能
- 运行时验证器性能开销可接受
- 翻译键查找性能良好
- 语言包加载性能优化

### 4. 质量保证
- 验证工具准确率高
- 误报和漏报率低
- 错误信息清晰有用
- 自动修复功能可靠

## 风险控制

### 1. 技术风险
- 验证工具性能影响
- 自动修复工具准确性
- 翻译键冲突问题
- 语言包同步复杂性

### 2. 业务风险
- 翻译质量下降
- 开发效率影响
- 团队学习成本
- 维护复杂度增加

### 3. 缓解措施
- 分阶段实施降低风险
- 充分测试确保质量
- 提供培训和支持
- 建立回滚机制

## 成功指标

### 1. 技术指标
- 硬编码文本检测准确率 > 95%
- 翻译键验证覆盖率 100%
- 构建时验证性能影响 < 5%
- 运行时验证性能影响 < 1%

### 2. 质量指标
- 翻译键命名规范符合率 100%
- 语言包结构一致性 100%
- 参数化翻译正确率 > 99%
- 自动修复成功率 > 90%

### 3. 效率指标
- 开发效率提升 > 10%
- 翻译维护效率提升 > 20%
- 错误发现时间减少 > 50%
- 修复时间减少 > 30%



